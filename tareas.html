<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Tareas - Estudio Colectivo UNAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="material-study.css">
</head>
<body>
    <!-- Barra superior -->
    <header class="md-top-app-bar">
        <div class="md-top-app-bar__row">
            <section class="md-top-app-bar__section">
                <span class="md-top-app-bar__nav-icon" id="menu-toggle">
                    <span class="material-icons">menu</span>
                </span>
                <span class="md-top-app-bar__title">Gestión de Tareas</span>
            </section>
            <section class="md-top-app-bar__section--align-end">
                <div class="md-top-app-bar__action-item">
                    <span class="material-icons">notifications</span>
                </div>
                <div class="md-top-app-bar__action-item" id="theme-toggle">
                    <span class="material-icons">dark_mode</span>
                </div>
                <div class="md-top-app-bar__action-item">
                    <div class="md-avatar md-avatar--small">
                        <span>U</span>
                    </div>
                </div>
            </section>
        </div>
    </header>

    <!-- Navegación lateral -->
    <div class="md-drawer" id="nav-drawer">
        <div class="md-drawer__header">
            <div class="md-drawer__title">Estudio Colectivo UNAL</div>
        </div>
        <div class="md-drawer__content">
            <nav class="md-nav-list">
                <a href="dashboard.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">dashboard</span>
                    <span class="md-nav-list__text">Dashboard</span>
                </a>
                <a href="grupos.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">group</span>
                    <span class="md-nav-list__text">Grupos</span>
                </a>
                <a href="tareas.html" class="md-nav-list__item md-nav-list__item--active">
                    <span class="md-nav-list__icon material-icons">assignment</span>
                    <span class="md-nav-list__text">Tareas</span>
                </a>
                <a href="calendario.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">calendar_today</span>
                    <span class="md-nav-list__text">Calendario</span>
                </a>
                <a href="resumenes.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">summarize</span>
                    <span class="md-nav-list__text">Resúmenes</span>
                </a>
                <a href="chat.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">chat</span>
                    <span class="md-nav-list__text">Chat</span>
                </a>
                <a href="evaluaciones.html" class="md-nav-list__item">
                    <span class="md-nav-list__icon material-icons">assignment_turned_in</span>
                    <span class="md-nav-list__text">Evaluaciones</span>
                </a>
            </nav>
        </div>
    </div>
    <div class="md-drawer__overlay" id="drawer-overlay"></div>

    <!-- Contenido principal -->
    <main class="container md-mt-large">
        <div class="md-layout-grid">
            <!-- Sección de creación de tareas -->
            <div class="md-layout-grid__cell md-layout-grid__cell--span-6-desktop">
                <div class="md-card">
                    <h4 class="md-card__title">Crear Nueva Tarea</h4>
                    <form id="crear-tarea-form">
                        <div class="md-text-field md-mb-medium">
                            <input id="titulo-tarea" class="md-text-field__input" type="text" placeholder=" " required>
                            <label for="titulo-tarea" class="md-text-field__label">Título de la tarea</label>
                        </div>
                        <div class="md-text-field md-mb-medium">
                            <textarea id="descripcion-tarea" class="md-text-field__input" rows="3" placeholder=" " required></textarea>
                            <label for="descripcion-tarea" class="md-text-field__label">Descripción de la tarea</label>
                        </div>

                        <div class="md-text-field md-mb-medium">
                            <select id="complejidad-tarea" class="md-text-field__input" required>
                                <option value="" disabled selected></option>
                                <option value="baja">Baja</option>
                                <option value="media">Media</option>
                                <option value="alta">Alta</option>
                            </select>
                            <label for="complejidad-tarea" class="md-text-field__label">Complejidad</label>
                        </div>

                        <div class="md-text-field md-mb-medium">
                            <input id="fecha-vencimiento" class="md-text-field__input" type="date" required>
                            <label for="fecha-vencimiento" class="md-text-field__label">Fecha de vencimiento</label>
                        </div>

                        <div class="md-text-field md-mb-medium">
                            <select id="usuario-asignado" class="md-text-field__input" required>
                                <option value="" disabled selected></option>
                                <option value="Juan Pérez">Juan Pérez</option>
                                <option value="María Gómez">María Gómez</option>
                                <option value="Carlos López">Carlos López</option>
                                <option value="Ana Torres">Ana Torres</option>
                                <option value="Luis Ramírez">Luis Ramírez</option>
                            </select>
                            <label for="usuario-asignado" class="md-text-field__label">Usuario asignado</label>
                        </div>

                        <div class="md-card__actions">
                            <button type="submit" class="md-button md-button--filled">Crear Tarea</button>
                            <button type="reset" class="md-button md-button--text">Limpiar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sección de tareas pendientes -->
            <div class="md-layout-grid__cell md-layout-grid__cell--span-6-desktop">
                <div class="md-card">
                    <h4 class="md-card__title">Tareas Pendientes</h4>
                    
                    <div class="md-text-field md-mb-medium">
                        <select id="equipo-select" class="md-text-field__input" required>
                            <option value="" disabled selected></option>
                            <option value="equipo1">Equipo de Matemáticas</option>
                            <option value="equipo2">Equipo de Física</option>
                            <option value="equipo3">Equipo de Historia</option>
                        </select>
                        <label for="equipo-select" class="md-text-field__label">Selecciona un equipo</label>
                    </div>

                    <div id="tareas-pendientes" class="md-list">
                        <!-- Las tareas se agregarán aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Botón flotante para añadir tarea rápida -->
    <div class="md-fab" id="agregar-tarea-rapida">
        <span class="material-icons">add</span>
    </div>

    <!-- Javascript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const crearTareaForm = document.getElementById('crear-tarea-form');
            const listaTareas = document.getElementById('tareas-pendientes');
            const equipoSelect = document.getElementById('equipo-select');
            const menuToggle = document.getElementById('menu-toggle');
            const navDrawer = document.getElementById('nav-drawer');
            const drawerOverlay = document.getElementById('drawer-overlay');
            const themeToggle = document.getElementById('theme-toggle');
            
            // Datos de ejemplo de tareas por equipo
            const tareasPorEquipo = {
                equipo1: [
                    { titulo: 'Resolver ejercicios de álgebra', descripcion: 'Completar los ejercicios 1 al 10', complejidad: 'media', fecha: '2023-11-15', usuario: 'Juan Pérez' },
                    { titulo: 'Preparar presentación', descripcion: 'Crear diapositivas para la exposición', complejidad: 'alta', fecha: '2023-11-20', usuario: 'María Gómez' }
                ],
                equipo2: [
                    { titulo: 'Estudiar leyes de Newton', descripcion: 'Leer el capítulo 3 del libro', complejidad: 'baja', fecha: '2023-11-18', usuario: 'Carlos López' }
                ],
                equipo3: [
                    { titulo: 'Investigar la Revolución Francesa', descripcion: 'Buscar fuentes confiables', complejidad: 'media', fecha: '2023-11-22', usuario: 'Ana Torres' }
                ]
            };

            // Función para renderizar las tareas según el equipo seleccionado
            function renderizarTareas(equipo) {
                listaTareas.innerHTML = '';
                const tareasEquipo = tareasPorEquipo[equipo] || [];
                
                if (tareasEquipo.length === 0) {
                    const mensajeVacio = document.createElement('div');
                    mensajeVacio.classList.add('md-card__subtitle', 'md-text-center');
                    mensajeVacio.textContent = 'No hay tareas pendientes para este equipo';
                    listaTareas.appendChild(mensajeVacio);
                    return;
                }
                
                tareasEquipo.forEach((tarea, index) => {
                    // Definir color de complejidad
                    let colorComplejidad = '';
                    switch(tarea.complejidad) {
                        case 'baja':
                            colorComplejidad = 'var(--md-success)';
                            break;
                        case 'media':
                            colorComplejidad = 'var(--md-warning)';
                            break;
                        case 'alta':
                            colorComplejidad = 'var(--md-error)';
                            break;
                    }
                    
                    const tareaElement = document.createElement('div');
                    tareaElement.classList.add('md-list__item');
                    tareaElement.innerHTML = `
                        <div class="md-list__text">
                            <div class="md-list__primary-text">${tarea.titulo}</div>
                            <div class="md-list__secondary-text">${tarea.descripcion}</div>
                            <div class="md-list__secondary-text">
                                <span class="md-chip" style="background-color: ${colorComplejidad}10; color: ${colorComplejidad}; border: 1px solid ${colorComplejidad}">
                                    ${tarea.complejidad}
                                </span>
                                <span class="md-chip">
                                    <span class="material-icons md-chip__icon" style="font-size: 16px;">calendar_today</span>
                                    ${tarea.fecha}
                                </span>
                                <span class="md-chip">
                                    <span class="material-icons md-chip__icon" style="font-size: 16px;">person</span>
                                    ${tarea.usuario}
                                </span>
                            </div>
                        </div>
                        <div class="md-list__meta">
                            <button class="md-button md-button--icon" onclick="editarTarea('${equipo}', ${index})">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="md-button md-button--icon" onclick="eliminarTarea('${equipo}', ${index})">
                                <span class="material-icons">delete</span>
                            </button>
                        </div>
                    `;
                    listaTareas.appendChild(tareaElement);
                });
            }

            // Toggle del menú lateral
            menuToggle.addEventListener('click', function() {
                navDrawer.classList.toggle('md-drawer--open');
                drawerOverlay.classList.toggle('md-drawer__overlay--open');
            });

            drawerOverlay.addEventListener('click', function() {
                navDrawer.classList.remove('md-drawer--open');
                drawerOverlay.classList.remove('md-drawer__overlay--open');
            });

            // Toggle del tema oscuro/claro
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-theme');
                const icon = themeToggle.querySelector('.material-icons');
                if (document.body.classList.contains('dark-theme')) {
                    icon.textContent = 'light_mode';
                } else {
                    icon.textContent = 'dark_mode';
                }
            });

            // Escuchar cambios en el menú desplegable de equipos
            equipoSelect.addEventListener('change', function () {
                const equipoSeleccionado = equipoSelect.value;
                renderizarTareas(equipoSeleccionado);
            });

            // Crear una nueva tarea
            crearTareaForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const titulo = document.getElementById('titulo-tarea').value;
                const descripcion = document.getElementById('descripcion-tarea').value;
                const complejidad = document.getElementById('complejidad-tarea').value;
                const fecha = document.getElementById('fecha-vencimiento').value;
                const usuario = document.getElementById('usuario-asignado').value;
                const equipoSeleccionado = equipoSelect.value;

                if (titulo && descripcion && complejidad && fecha && usuario && equipoSeleccionado) {
                    if (!tareasPorEquipo[equipoSeleccionado]) {
                        tareasPorEquipo[equipoSeleccionado] = [];
                    }
                    
                    tareasPorEquipo[equipoSeleccionado].push({ titulo, descripcion, complejidad, fecha, usuario });
                    renderizarTareas(equipoSeleccionado);
                    
                    // Mostrar snackbar de confirmación
                    mostrarSnackbar('Tarea creada correctamente');
                    
                    crearTareaForm.reset();
                } else {
                    mostrarSnackbar('Por favor, completa todos los campos y selecciona un equipo', true);
                }
            });
            
            // Función para mostrar snackbar
            function mostrarSnackbar(mensaje, esError = false) {
                // Eliminar snackbar existente si hay
                const snackbarExistente = document.querySelector('.md-snackbar');
                if (snackbarExistente) {
                    snackbarExistente.remove();
                }
                
                const snackbar = document.createElement('div');
                snackbar.classList.add('md-snackbar');
                snackbar.innerHTML = `
                    <div class="md-snackbar__text">${mensaje}</div>
                    <button class="md-snackbar__action">Cerrar</button>
                `;
                
                if (esError) {
                    snackbar.style.backgroundColor = 'var(--md-error)';
                }
                
                document.body.appendChild(snackbar);
                
                // Mostrar el snackbar
                setTimeout(() => {
                    snackbar.classList.add('md-snackbar--visible');
                }, 10);
                
                // Ocultar después de 4 segundos
                setTimeout(() => {
                    snackbar.classList.remove('md-snackbar--visible');
                    setTimeout(() => {
                        snackbar.remove();
                    }, 300);
                }, 4000);
                
                // Botón de cerrar
                snackbar.querySelector('.md-snackbar__action').addEventListener('click', function() {
                    snackbar.classList.remove('md-snackbar--visible');
                    setTimeout(() => {
                        snackbar.remove();
                    }, 300);
                });
            }

            // Funciones para editar y eliminar tareas
            window.eliminarTarea = function (equipo, index) {
                tareasPorEquipo[equipo].splice(index, 1);
                renderizarTareas(equipo);
                mostrarSnackbar('Tarea eliminada correctamente');
            };

            window.editarTarea = function (equipo, index) {
                const tarea = tareasPorEquipo[equipo][index];
                document.getElementById('titulo-tarea').value = tarea.titulo;
                document.getElementById('descripcion-tarea').value = tarea.descripcion;
                document.getElementById('complejidad-tarea').value = tarea.complejidad;
                document.getElementById('fecha-vencimiento').value = tarea.fecha;
                document.getElementById('usuario-asignado').value = tarea.usuario;
                
                // Hacer scroll hacia el formulario
                document.querySelector('.md-card').scrollIntoView({ behavior: 'smooth' });
                
                // Eliminar la tarea existente
                tareasPorEquipo[equipo].splice(index, 1);
                renderizarTareas(equipo);
                
                // Mostrar mensaje
                mostrarSnackbar('Editando tarea. Completa el formulario y guarda los cambios.');
            };
            
            // Inicializar la lista vacía
            equipoSelect.value = '';
        });
    </script>
</body>
</html>